<div class="container-titulo">
  <h1>Configuración de horario</h1>
  <span
    ngClass="m-3 d-flex justify-content-end cerrar"
    (click)="cerrar()"
    (keyup.enter)="cerrar()"
    tabindex="0"
    role="button"
    aria-label="Cerrar"
  >
    <i class="material-icons">close</i>
  </span>
</div>

<mat-dialog-content class="form-content">
  <form [formGroup]="formularioHorarios">
    <div class="row">
      <div class="col-md-12">
        <ng-select
          formControlName="establishment"
          [items]="establishmentDto"
          bindLabel="name"
          bindValue="id"
          placeholder="Establecimiento* "
          [ngClass]="{ 'ng-select-error': validarEstablecimiento() }"
        ></ng-select>
        <small class="text-error" *ngIf="validarEstablecimiento()">
          {{ establishmentError }}
        </small>
      </div>
    </div>

    <div class="row">
      <div *ngIf="listaCanchas.length > 0" class="col-md-6 canchas">
        <div>
          <span class="titulo">Canchas: </span>
        </div>

        <div class="checkbox-canchas">
          <ng-container formArrayName="cancha">
            <mat-checkbox
              *ngFor="let cancha of listaCanchas; let i = index"
              [formControlName]="i"
              color="primary"
            >
              {{ cancha.name }}
            </mat-checkbox>
            <small class="text-error" *ngIf="validarCancha()">
              {{ canchaError }}
            </small>
          </ng-container>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-6">
        <mat-form-field class="input-field">
          <mat-label>Valor</mat-label>
          <input
            matInput
            [value]="valorFormateado"
            (blur)="formatearValor()"
            (input)="actualizarValorMoneda($event)"
          />
        </mat-form-field>
      </div>

      <div class="col-md-6">
        <ng-select
          formControlName="repetir"
          placeholder="Repetir*"
          appendTo="body"
          (change)="onRepetirChange($event)"
        >
          <ng-option [value]="'NONE'">No se repite</ng-option>
          <ng-option [value]="'WEEKLY'"
            >Cada semana, el {{ diaSemana }}</ng-option
          >
          <ng-option [value]="'WEEKDAY'"
            >Todos los días hábiles (lunes a viernes)</ng-option
          >
          <ng-option [value]="'CUSTOM'">Personalizar...</ng-option>
        </ng-select>
      </div>

      <!-- Solo visible si se selecciona "CUSTOM" -->
      <div *ngIf="mostrarDiasPersonalizados" class="col-md-12 checkbox-dias">
        <span class="titulo">Repite el:</span>
        <div class="checkbox-individual">
          <div *ngFor="let dia of diasSemana">
            <input
              type="checkbox"
              [id]="dia.codigo"
              [value]="dia.codigo"
              (change)="toggleDiaSeleccionado(dia.codigo, $event)"
              [checked]="diasSeleccionados.includes(dia.codigo)"
            />
            <label [for]="dia.codigo" class="label-dia">{{ dia.nombre }}</label>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-6">
        <mat-form-field class="input-field">
          <mat-label>Fecha inicio*</mat-label>
          <input
            matInput
            [matDatepicker]="picker"
            formControlName="fecha_inicio"
          />
          <mat-datepicker-toggle
            matIconSuffix
            [for]="picker"
          ></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>
      </div>
      <div class="col-md-6">
        <mat-form-field class="input-field">
          <mat-label>Fecha fin*</mat-label>
          <input
            matInput
            [matDatepicker]="pickerFechaFin"
            formControlName="fecha_fin"
            readonly
          />
          <mat-datepicker-toggle
            matSuffix
            [for]="pickerFechaFin"
          ></mat-datepicker-toggle>
          <mat-datepicker #pickerFechaFin></mat-datepicker>
        </mat-form-field>
      </div>
    </div>

    <div class="row">
      <div class="col-md-6">
        <mat-form-field class="input-field">
          <mat-label>Hora incio:</mat-label>
          <input formControlName="hora_inicio" matInput type="text" />
        </mat-form-field>
      </div>

      <div class="col-md-6">
        <mat-form-field class="input-field">
          <mat-label>Hora fin:</mat-label>
          <input formControlName="hora_fin" matInput type="text" />
        </mat-form-field>
      </div>
    </div>
  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <div class="boton">
    <button mat-button (click)="cerrar()">Cancelar</button>
    <button mat-flat-button class="btn" type="button" (click)="guardar()">
      Guardar
    </button>
  </div>
</mat-dialog-actions>
